var util = require('util')
  , exec = require('child_process').exec,
    child;

var io = require('socket.io-client'),
socket = io.connect('localhost', {
    port: 3700
});
socket.on('connect', function () { console.log("socket connected"); });

process.nextTick(function() {
setInterval(function() {

  child = exec('top -b -n1| grep Cpu | awk \'{print $2}\'',
  function (error, stdout, stderr) {
    stdout.replace(/(\n|\r|\r\n)$/, '');
    console.log("CPU is now at " + stdout);
    socket.emit('send', { UID: stdout, reader: '0' });
  });

  }, 500);
});
